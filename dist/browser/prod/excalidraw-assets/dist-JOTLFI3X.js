import{Oa as B,b as Ct,c as Nt,z as Lt}from"./chunk-B7LZIDS3.js";import{a as f}from"./chunk-M2JW2GFW.js";import{d as Ot,f as V}from"./chunk-SXMPUQ6M.js";var at=Ot(W=>{"use strict";f();Object.defineProperty(W,"__esModule",{value:!0});W.removeMarkdown=void 0;var _t=function(t,e){e===void 0&&(e={listUnicodeChar:""}),e=e||{},e.listUnicodeChar=e.hasOwnProperty("listUnicodeChar")?e.listUnicodeChar:!1,e.stripListLeaders=e.hasOwnProperty("stripListLeaders")?e.stripListLeaders:!0,e.gfm=e.hasOwnProperty("gfm")?e.gfm:!0,e.useImgAltText=e.hasOwnProperty("useImgAltText")?e.useImgAltText:!0,e.preserveLinks=e.hasOwnProperty("preserveLinks")?e.preserveLinks:!1;var r=t||"";r=r.replace(/^(-\s*?|\*\s*?|_\s*?){3,}\s*$/gm,"");try{e.stripListLeaders&&(e.listUnicodeChar?r=r.replace(/^([\s\t]*)([\*\-\+]|\d+\.)\s+/gm,e.listUnicodeChar+" $1"):r=r.replace(/^([\s\t]*)([\*\-\+]|\d+\.)\s+/gm,"$1")),e.gfm&&(r=r.replace(/\n={2,}/g,`
`).replace(/~{3}.*\n/g,"").replace(/~~/g,"").replace(/`{3}.*\n/g,"")),e.preserveLinks&&(r=r.replace(/\[(.*?)\][\[\(](.*?)[\]\)]/g,"$1 ($2)")),r=r.replace(/<[^>]*>/g,"").replace(/^[=\-]{2,}\s*$/g,"").replace(/\[\^.+?\](\: .*?$)?/g,"").replace(/\s{0,2}\[.*?\]: .*?$/g,"").replace(/\!\[(.*?)\][\[\(].*?[\]\)]/g,e.useImgAltText?"$1":"").replace(/\[(.*?)\][\[\(].*?[\]\)]/g,"$1").replace(/^\s{0,3}>\s?/g,"").replace(/(^|\n)\s{0,3}>\s?/g,`

`).replace(/^\s{1,2}\[(.*?)\]: (\S+)( ".*?")?\s*$/g,"").replace(/^(\n)?\s{0,}#{1,6}\s+| {0,}(\n)?\s{0,}#{0,} {0,}(\n)?\s{0,}$/gm,"$1$2$3").replace(/([\*_]{1,3})(\S.*?\S{0,1})\1/g,"$2").replace(/([\*_]{1,3})(\S.*?\S{0,1})\1/g,"$2").replace(/(`{3,})(.*?)\1/gm,"$2").replace(/`(.+?)`/g,"$1").replace(/\n{2,}/g,`

`)}catch(o){return console.error(o),t}return r};W.removeMarkdown=_t});f();f();f();f();f();var st={rect:"rectangle",circle:"ellipse"},nt={startOnLoad:!1,flowchart:{curve:"linear"},themeVariables:{fontSize:`${20*1.25}px`}};var L=class{constructor({converter:e}){this.convert=(r,o)=>this.converter(r,{...o,fontSize:o.fontSize||20}),this.converter=e}};f();f();var P;(function(t){t.ROUND="round",t.STADIUM="stadium",t.DOUBLECIRCLE="doublecircle",t.CIRCLE="circle",t.DIAMOND="diamond"})(P||(P={}));var z;(function(t){t.COLOR="color"})(z||(z={}));var $;(function(t){t.FILL="fill",t.STROKE="stroke",t.STROKE_WIDTH="stroke-width",t.STROKE_DASHARRAY="stroke-dasharray"})($||($={}));var it=V(at(),1),Dt={arrow_circle:{endArrowhead:"dot"},arrow_cross:{endArrowhead:"bar"},double_arrow_circle:{endArrowhead:"dot",startArrowhead:"dot"},double_arrow_cross:{endArrowhead:"bar",startArrowhead:"bar"},double_arrow_point:{endArrowhead:"arrow",startArrowhead:"arrow"}},ct=t=>Dt[t],U=t=>{let e=t.text;return t.labelType==="markdown"&&(e=(0,it.removeMarkdown)(t.text)),Rt(e)},Rt=t=>{let e=/\s?(fa|fab):[a-zA-Z0-9-]+/g;return t.replace(e,"")},lt=t=>{let e={};return Object.keys(t).forEach(r=>{switch(r){case $.FILL:{e.backgroundColor=t[r],e.fillStyle="solid";break}case $.STROKE:{e.strokeColor=t[r];break}case $.STROKE_WIDTH:{e.strokeWidth=Number(t[r]?.split("px")[0]);break}case $.STROKE_DASHARRAY:{e.strokeStyle="dashed";break}}}),e},dt=t=>{let e={};return Object.keys(t).forEach(r=>{switch(r){case z.COLOR:{e.strokeColor=t[r];break}}}),e};var Pt=t=>{let e={};t.subGraphs.map(o=>{o.nodeIds.forEach(n=>{e[o.id]={id:o.id,parent:null,isLeaf:!1},e[n]={id:n,parent:o.id,isLeaf:t.vertices[n]!==void 0}})});let r={};return[...Object.keys(t.vertices),...t.subGraphs.map(o=>o.id)].forEach(o=>{if(!e[o])return;let n=e[o],a=[];for(n.isLeaf||a.push(`subgraph_group_${n.id}`);n.parent;)a.push(`subgraph_group_${n.parent}`),n=e[n.parent];r[o]=a}),{getGroupIds:o=>r[o]||[],getParentId:o=>e[o]?e[o].parent:null}},ut=new L({converter:(t,e)=>{let r=[],o=e.fontSize,{getGroupIds:n,getParentId:a}=Pt(t);return t.subGraphs.reverse().forEach(s=>{let i=n(s.id),c={id:s.id,type:"rectangle",groupIds:i,x:s.x,y:s.y,width:s.width,height:s.height,label:{groupIds:i,text:U(s),fontSize:o,verticalAlign:"top"}};r.push(c)}),Object.values(t.vertices).forEach(s=>{if(!s)return;let i=n(s.id),c=lt(s.containerStyle),l=dt(s.labelStyle),d={id:s.id,type:"rectangle",groupIds:i,x:s.x,y:s.y,width:s.width,height:s.height,strokeWidth:2,label:{groupIds:i,text:U(s),fontSize:o,...l},link:s.link||null,...c};switch(s.type){case P.STADIUM:{d={...d,roundness:{type:3}};break}case P.ROUND:{d={...d,roundness:{type:3}};break}case P.DOUBLECIRCLE:{i.push(`doublecircle_${s.id}}`);let h={type:"ellipse",groupIds:i,x:s.x+5,y:s.y+5,width:s.width-5*2,height:s.height-5*2,strokeWidth:2,roundness:{type:3},label:{groupIds:i,text:U(s),fontSize:o}};d={...d,groupIds:i,type:"ellipse"},r.push(h);break}case P.CIRCLE:{d.type="ellipse";break}case P.DIAMOND:{d.type="diamond";break}}r.push(d)}),t.edges.forEach(s=>{let i=[],c=a(s.start),l=a(s.end);c&&c===l&&(i=n(c));let{startX:d,startY:u,reflectionPoints:h}=s,p=h.map(b=>[b.x-h[0].x,b.y-h[0].y]),w=ct(s.type),y={id:`${s.start}_${s.end}`,type:"arrow",groupIds:i,x:d,y:u,strokeWidth:s.stroke==="thick"?4:2,strokeStyle:s.stroke==="dotted"?"dashed":void 0,points:p,...s.text?{label:{text:U(s),fontSize:o,groupIds:i}}:{},roundness:{type:2},...w},A=r.find(b=>b.id===s.start),x=r.find(b=>b.id===s.end);!A||!x||(y.start={id:A.id||""},y.end={id:x.id||""},r.push(y))}),{elements:r}}});f();f();var I=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,r)=>(r&=63,r<36?e+=r.toString(36):r<62?e+=(r-26).toString(36).toUpperCase():r>62?e+="-":e+="_",e),"");var pt=new L({converter:t=>{let e=I(),{width:r,height:o}=t,n={type:"image",x:0,y:0,width:r,height:o,status:"saved",fileId:e};return{files:{[e]:{id:e,mimeType:t.mimeType,dataURL:t.dataURL}},elements:[n]}}});f();f();var X=t=>{let e={type:"line",x:t.startX,y:t.startY,points:[[0,0],[t.endX-t.startX,t.endY-t.startY]],width:t.endX-t.startX,height:t.endY-t.startY,strokeStyle:t.strokeStyle||"solid",strokeColor:t.strokeColor||"#000",strokeWidth:t.strokeWidth||1};return t.groupId&&Object.assign(e,{groupIds:[t.groupId]}),t.id&&Object.assign(e,{id:t.id}),e},F=t=>{let e={type:"text",x:t.x,y:t.y,width:t.width,height:t.height,text:t.text||"",fontSize:t.fontSize,verticalAlign:"middle"};return t.groupId&&Object.assign(e,{groupIds:[t.groupId]}),t.id&&Object.assign(e,{id:t.id}),e},G=t=>{let e={};t.type==="rectangle"&&t.subtype==="activation"&&(e={backgroundColor:"#e9ecef",fillStyle:"solid"});let r={id:t.id,type:t.type,x:t.x,y:t.y,width:t.width,height:t.height,label:{text:t?.label?.text||"",fontSize:t?.label?.fontSize,verticalAlign:t.label?.verticalAlign||"middle",strokeColor:t.label?.color||"#000",groupIds:t.groupId?[t.groupId]:[]},strokeStyle:t?.strokeStyle,strokeWidth:t?.strokeWidth,strokeColor:t?.strokeColor,backgroundColor:t?.bgColor,fillStyle:"solid",...e};return t.groupId&&Object.assign(r,{groupIds:[t.groupId]}),r},H=t=>{let e={type:"arrow",x:t.startX,y:t.startY,points:t.points||[[0,0],[t.endX-t.startX,t.endY-t.startY]],width:t.endX-t.startX,height:t.endY-t.startY,strokeStyle:t?.strokeStyle||"solid",endArrowhead:t?.endArrowhead||null,startArrowhead:t?.startArrowhead||null,label:{text:t?.label?.text||"",fontSize:16},roundness:{type:2},start:t.start,end:t.end};return t.groupId&&Object.assign(e,{groupIds:[t.groupId]}),e};var mt=new L({converter:t=>{let e=[],r=[];if(Object.values(t.nodes).forEach(o=>{!o||!o.length||o.forEach(n=>{let a;switch(n.type){case"line":a=X(n);break;case"rectangle":case"ellipse":a=G(n);break;case"text":a=F(n);break;default:throw`unknown type ${n.type}`}n.type==="rectangle"&&n?.subtype==="activation"?r.push(a):e.push(a)})}),Object.values(t.lines).forEach(o=>{o&&e.push(X(o))}),Object.values(t.arrows).forEach(o=>{o&&(e.push(H(o)),o.sequenceNumber&&e.push(G(o.sequenceNumber)))}),e.push(...r),t.loops){let{lines:o,texts:n,nodes:a}=t.loops;o.forEach(s=>{e.push(X(s))}),n.forEach(s=>{e.push(F(s))}),a.forEach(s=>{e.push(G(s))})}return t.groups&&t.groups.forEach(o=>{let{actorKeys:n,name:a}=o,s=1/0,i=1/0,c=0,l=0;if(!n.length)return;e.filter(m=>{if(m.id){let D=m.id.indexOf("-"),j=m.id.substring(0,D);return n.includes(j)}}).forEach(m=>{if(m.x===void 0||m.y===void 0||m.width===void 0||m.height===void 0)throw new Error(`Actor attributes missing ${m}`);s=Math.min(s,m.x),i=Math.min(i,m.y),c=Math.max(c,m.x+m.width),l=Math.max(l,m.y+m.height)});let u=10,h=s-u,p=i-u,w=c-s+u*2,g=l-i+u*2,y=I(),A=G({type:"rectangle",x:h,y:p,width:w,height:g,bgColor:o.fill,id:y});e.unshift(A);let x=I(),b=[y];e.forEach(m=>{if(m.type!=="frame"){if(m.x===void 0||m.y===void 0||m.width===void 0||m.height===void 0)throw new Error(`Element attributes missing ${m}`);if(m.x>=s&&m.x+m.width<=c&&m.y>=i&&m.y+m.height<=l){let D=m.id||I();m.id||Object.assign(m,{id:D}),b.push(D)}}});let E={type:"frame",id:x,name:a,children:b};e.push(E)}),{elements:e}}});f();var ht=new L({converter:t=>{let e=[];return Object.values(t.nodes).forEach(r=>{!r||!r.length||r.forEach(o=>{let n;switch(o.type){case"line":n=X(o);break;case"rectangle":case"ellipse":n=G(o);break;case"text":n=F(o);break;default:throw`unknown type ${o.type}`}e.push(n)})}),Object.values(t.lines).forEach(r=>{r&&e.push(X(r))}),Object.values(t.arrows).forEach(r=>{if(!r)return;let o=H(r);e.push(o)}),Object.values(t.text).forEach(r=>{let o=F(r);e.push(o)}),Object.values(t.namespaces).forEach(r=>{let o=Object.keys(r.classes),n=[...o],a=[...t.lines,...t.arrows,...t.text];o.forEach(i=>{let c=a.filter(l=>l.metadata&&"class"in l.metadata&&l.metadata.classId===i).map(l=>l.id);c.length&&n.push(...c)});let s={type:"frame",id:I(),name:r.id,children:n};e.push(s)}),{elements:e}}});var ft=(t,e={})=>{switch(t.type){case"graphImage":return pt.convert(t,e);case"flowchart":return ut.convert(t,e);case"sequence":return mt.convert(t,e);case"class":return ht.convert(t,e);default:throw new Error(`graphToExcalidraw: unknown graph type "${t.type}, only flowcharts are supported!"`)}};f();f();var Ge=V(Ct(),1),qe=V(Nt(),1);var je=V(Lt(),1);f();var v=t=>{t=vt(t);let e=t.replace(/#(\d+);/g,"&#$1;").replace(/#([a-z]+);/g,"&$1;"),r=document.createElement("textarea");return r.innerHTML=e,r.value},Y=t=>{let r=t.getAttribute("transform")?.match(/translate\(([ \d.-]+),\s*([\d.-]+)\)/),o=0,n=0;return r&&(o=Number(r[1]),n=Number(r[2])),{transformX:o,transformY:n}},gt=t=>{let e=t;return e=e.replace(/style.*:\S*#.*;/g,r=>r.substring(0,r.length-1)),e=e.replace(/classDef.*:\S*#.*;/g,r=>r.substring(0,r.length-1)),e=e.replace(/#\w+;/g,r=>{let o=r.substring(1,r.length-1);return/^\+?\d+$/.test(o)?`\uFB02\xB0\xB0${o}\xB6\xDF`:`\uFB02\xB0${o}\xB6\xDF`}),e},vt=function(t){return t.replace(/ﬂ°°/g,"#").replace(/ﬂ°/g,"&").replace(/¶ß/g,";")},K=(t,e={x:0,y:0})=>{if(t.tagName.toLowerCase()!=="path")throw new Error(`Invalid input: Expected an HTMLElement of tag "path", got ${t.tagName}`);let r=t.getAttribute("d");if(!r)throw new Error('Path element does not contain a "d" attribute');let o=r.split(/(?=[LM])/),n=o[0].substring(1).split(",").map(i=>parseFloat(i)),a=o[o.length-1].substring(1).split(",").map(i=>parseFloat(i)),s=o.map(i=>{let c=i.substring(1).split(",").map(l=>parseFloat(l));return{x:c[0],y:c[1]}}).filter((i,c,l)=>{if(c===l.length-1)return!0;let d=l[c-1];return c===0||i.x!==d.x&&i.y!==d.y}).map(i=>({x:i.x+e.x,y:i.y+e.y}));return{startX:n[0]+e.x,startY:n[1]+e.y,endX:a[0]+e.x,endY:a[1]+e.y,reflectionPoints:s}};f();var Yt=(t,e)=>{let r=t.nodes.map(i=>i.startsWith("flowchart-")?i.split("-")[1]:i),o=e.querySelector(`[id='${t.id}']`);if(!o)throw new Error("SubGraph element not found");let n=et(o,e),a=o.getBBox(),s={width:a.width,height:a.height};return t.classes=void 0,t.dir=void 0,{...t,nodeIds:r,...n,...s,text:v(t.title)}},Mt=(t,e)=>{let r=e.querySelector(`[id*="flowchart-${t.id}-"]`);if(!r)return;let o;r.parentElement?.tagName.toLowerCase()==="a"&&(o=r.parentElement.getAttribute("xlink:href"));let n=et(o?r.parentElement:r,e),a=r.getBBox(),s={width:a.width,height:a.height},i=r.querySelector(".label-container")?.getAttribute("style"),c=r.querySelector(".label")?.getAttribute("style"),l={};i?.split(";").forEach(u=>{if(!u)return;let h=u.split(":")[0].trim(),p=u.split(":")[1].trim();l[h]=p});let d={};return c?.split(";").forEach(u=>{if(!u)return;let h=u.split(":")[0].trim(),p=u.split(":")[1].trim();d[h]=p}),{id:t.id,labelType:t.labelType,text:v(t.text),type:t.type,link:o||void 0,...n,...s,containerStyle:l,labelStyle:d}},$t=(t,e)=>{let r=e.querySelector(`[id*="L-${t.start}-${t.end}"]`);if(!r)throw new Error("Edge element not found");let o=et(r,e),n=K(r,o);return t.length=void 0,{...t,...n,text:v(t.text)}},et=(t,e)=>{if(!t)throw new Error("Element not found");let r=t.parentElement?.parentElement,o=t.childNodes[0],n={x:0,y:0};if(o){let{transformX:c,transformY:l}=Y(o),d=o.getBBox();n={x:Number(o.getAttribute("x"))||c+d.x||0,y:Number(o.getAttribute("y"))||l+d.y||0}}let{transformX:a,transformY:s}=Y(t),i={x:a+n.x,y:s+n.y};for(;r&&r.id!==e.id;){if(r.classList.value==="root"&&r.hasAttribute("transform")){let{transformX:c,transformY:l}=Y(r);i.x+=c,i.y+=l}r=r.parentElement}return i},bt=(t,e)=>{t.parse();let r=t.parser.yy,o=r.getVertices();Object.keys(o).forEach(s=>{o[s]=Mt(o[s],e)});let n=r.getEdges().map(s=>$t(s,e));return{type:"flowchart",subGraphs:r.getSubGraphs().map(s=>Yt(s,e)),vertices:o,edges:n}};f();f();var xt=(t,e)=>{let r={};e?.label&&(r.label={text:v(e.label),fontSize:16});let o=t.tagName;if(o==="line")r.startX=Number(t.getAttribute("x1")),r.startY=Number(t.getAttribute("y1")),r.endX=Number(t.getAttribute("x2")),r.endY=Number(t.getAttribute("y2"));else if(o==="path"){let n=t.getAttribute("d");if(!n)throw new Error('Path element does not contain a "d" attribute');let a=n.split(/(?=[LC])/),s=a[0].substring(1).split(",").map(l=>parseFloat(l)),i=[];a.forEach(l=>{let d=l.substring(1).trim().split(" ").map(u=>{let[h,p]=u.split(",");return[parseFloat(h)-s[0],parseFloat(p)-s[1]]});i.push(...d)});let c=i[i.length-1];r.startX=s[0],r.startY=s[1],r.endX=c[0],r.endY=c[1],r.points=i}return e?.label&&(r.startY=r.startY-10,r.endY=r.endY-10),r.strokeColor=t.getAttribute("stroke"),r.strokeWidth=Number(t.getAttribute("stroke-width")),r.type="arrow",r.strokeStyle=e?.strokeStyle||"solid",r.startArrowhead=e?.startArrowhead||null,r.endArrowhead=e?.endArrowhead||null,r},rt=(t,e,r,o,n)=>{let a={};return a.type="arrow",a.startX=t,a.startY=e,a.endX=r,a.endY=o,Object.assign(a,{...n}),a},Z=(t,e,r,o)=>({type:"text",x:t,y:e,text:r,width:o?.width||20,height:o?.height||20,fontSize:o?.fontSize||20,id:o?.id,groupId:o?.groupId,metadata:o?.metadata}),ot=(t,e,r)=>{let o={},n=Number(t.getAttribute("x")),a=Number(t.getAttribute("y"));o.type="text",o.text=v(e),r?.id&&(o.id=r.id),r?.groupId&&(o.groupId=r.groupId);let s=t.getBBox();o.width=s.width,o.height=s.height,o.x=n-s.width/2,o.y=a;let i=parseInt(getComputedStyle(t).fontSize);return o.fontSize=i,o},O=(t,e,r={})=>{let o={};o.type=e;let{label:n,subtype:a,id:s,groupId:i}=r;o.id=s,i&&(o.groupId=i),n&&(o.label={text:v(n.text),fontSize:16,verticalAlign:n?.verticalAlign});let c=t.getBBox();switch(o.x=c.x,o.y=c.y,o.width=c.width,o.height=c.height,o.subtype=a,a){case"highlight":let l=t.getAttribute("fill");l&&(o.bgColor=l);break;case"note":o.strokeStyle="dashed";break}return o},q=(t,e,r,o,n,a)=>{let s={};return s.startX=e,s.startY=r,s.endX=o,a?.groupId&&(s.groupId=a.groupId),a?.id&&(s.id=a.id),s.endY=n,s.strokeColor=t.getAttribute("stroke"),s.strokeWidth=Number(t.getAttribute("stroke-width")),s.type="line",s};var yt={0:"SOLID",1:"DOTTED",3:"SOLID_CROSS",4:"DOTTED_CROSS",5:"SOLID_OPEN",6:"DOTTED_OPEN",24:"SOLID_POINT",25:"DOTTED_POINT"},_={SOLID:0,DOTTED:1,NOTE:2,SOLID_CROSS:3,DOTTED_CROSS:4,SOLID_OPEN:5,DOTTED_OPEN:6,LOOP_START:10,LOOP_END:11,ALT_START:12,ALT_ELSE:13,ALT_END:14,OPT_START:15,OPT_END:16,ACTIVE_START:17,ACTIVE_END:18,PAR_START:19,PAR_AND:20,PAR_END:21,RECT_START:22,RECT_END:23,SOLID_POINT:24,DOTTED_POINT:25,AUTONUMBER:26,CRITICAL_START:27,CRITICAL_OPTION:28,CRITICAL_END:29,BREAK_START:30,BREAK_END:31,PAR_OVER_START:32},Xt=t=>{let e;switch(t){case _.SOLID:case _.SOLID_CROSS:case _.SOLID_OPEN:case _.SOLID_POINT:e="solid";break;case _.DOTTED:case _.DOTTED_CROSS:case _.DOTTED_OPEN:case _.DOTTED_POINT:e="dotted";break;default:e="solid";break}return e},Gt=(t,e)=>{if(!!t.nextElementSibling?.classList.contains("sequenceNumber")){let o=t.nextElementSibling?.textContent;if(!o)throw new Error("sequence number not present");let n=30,a=n/2,s=10,i={type:"rectangle",x:e.startX-s,y:e.startY-a,label:{text:o,fontSize:14},bgColor:"#e9ecef",height:n,subtype:"sequence"};Object.assign(e,{sequenceNumber:i})}},Et=(t,e,r)=>{if(!t)throw"root node not found";let o=I(),n=Array.from(t.children),a=[];return n.forEach((s,i)=>{let c=`${r?.id}-${i}`,l;switch(s.tagName){case"line":let d=Number(s.getAttribute("x1")),u=Number(s.getAttribute("y1")),h=Number(s.getAttribute("x2")),p=Number(s.getAttribute("y2"));l=q(s,d,u,h,p,{groupId:o,id:c});break;case"text":l=ot(s,e,{groupId:o,id:c});break;case"circle":l=O(s,"ellipse",{label:s.textContent?{text:s.textContent}:void 0,groupId:o,id:c});default:l=O(s,st[s.tagName],{label:s.textContent?{text:s.textContent}:void 0,groupId:o,id:c})}a.push(l)}),a},qt=(t,e)=>{let r=Array.from(e.querySelectorAll(".actor")).filter(s=>s.tagName==="text").map(s=>s.parentElement),o=[],n=[],a=Object.keys(t).length;return Object.values(t).forEach((s,i)=>{let c=r[i],l=r[a+i];if(!c||!l)throw"root not found";let d=s.description;if(s.type==="participant"){let u=O(c.firstChild,"rectangle",{id:`${s.name}-top`,label:{text:d},subtype:"actor"});if(!u)throw"Top Node element not found!";o.push([u]);let h=O(l.firstChild,"rectangle",{id:`${s.name}-bottom`,label:{text:d},subtype:"actor"});o.push([h]);let p=c.previousElementSibling;if(p?.tagName!=="line")throw"Line not found";let w=Number(p.getAttribute("x1"));if(!u.height)throw"Top node element height is null";let g=u.y+u.height,y=h.y,A=Number(p.getAttribute("x2")),x=q(p,w,g,A,y);n.push(x)}else if(s.type==="actor"){let u=Et(c,d,{id:`${s.name}-top`});o.push(u);let h=Et(l,d,{id:`${s.name}-bottom`});o.push(h);let p=c.previousElementSibling;if(p?.tagName!=="line")throw"Line not found";let w=Number(p.getAttribute("x1")),g=Number(p.getAttribute("y1")),y=Number(p.getAttribute("x2")),A=h.find(x=>x.type==="ellipse");if(A){let x=A.y,b=q(p,w,g,y,x);n.push(b)}}}),{nodes:o,lines:n}},Ft=(t,e)=>{let r=[],o=Array.from(e.querySelectorAll('[class*="messageLine"]')),n=Object.keys(yt),a=t.filter(s=>n.includes(s.type.toString()));return o.forEach((s,i)=>{let c=a[i],l=yt[c.type],d=xt(s,{label:c?.message,strokeStyle:Xt(c.type),endArrowhead:l==="SOLID_OPEN"||l==="DOTTED_OPEN"?null:"arrow"});Gt(s,d),r.push(d)}),r},jt=(t,e)=>{let r=Array.from(e.querySelectorAll(".note")).map(a=>a.parentElement),o=t.filter(a=>a.type===_.NOTE),n=[];return r.forEach((a,s)=>{if(!a)return;let i=a.firstChild,c=o[s].message,l=O(i,"rectangle",{label:{text:c},subtype:"note"});n.push(l)}),n},Bt=t=>{let e=Array.from(t.querySelectorAll("[class*=activation]")),r=[];return e.forEach(o=>{let n=O(o,"rectangle",{label:{text:""},subtype:"activation"});r.push(n)}),r},Ut=(t,e)=>{let r=Array.from(e.querySelectorAll(".loopLine")),o=[],n=[],a=[];r.forEach(d=>{let u=Number(d.getAttribute("x1")),h=Number(d.getAttribute("y1")),p=Number(d.getAttribute("x2")),w=Number(d.getAttribute("y2")),g=q(d,u,h,p,w);g.strokeStyle="dotted",g.strokeColor="#adb5bd",g.strokeWidth=2,o.push(g)});let s=Array.from(e.querySelectorAll(".loopText")),i=t.filter(d=>d.type===_.CRITICAL_START).map(d=>d.message);s.forEach(d=>{let u=d.textContent||"",h=ot(d,u),p=u.match(/\[(.*?)\]/)?.[1]||"";i.includes(p)&&(h.x+=16),n.push(h)});let c=Array.from(e?.querySelectorAll(".labelBox")),l=Array.from(e?.querySelectorAll(".labelText"));return c.forEach((d,u)=>{let h=l[u]?.textContent||"",p=O(d,"rectangle",{label:{text:h}});p.strokeColor="#adb5bd",p.bgColor="#e9ecef",p.width=void 0,a.push(p)}),{lines:o,texts:n,nodes:a}},Vt=t=>{let e=Array.from(t.querySelectorAll(".rect")).filter(o=>o.parentElement?.tagName!=="g"),r=[];return e.forEach(o=>{let n=O(o,"rectangle",{label:{text:""},subtype:"highlight"});r.push(n)}),r},wt=(t,e)=>{t.parse();let r=t.parser.yy,o=[],n=r.getBoxes(),a=Vt(e),s=r.getActors(),{nodes:i,lines:c}=qt(s,e),l=r.getMessages(),d=Ft(l,e),u=jt(l,e),h=Bt(e),p=Ut(l,e);return o.push(a),o.push(...i),o.push(u),o.push(h),{type:"sequence",lines:c,arrows:d,nodes:o,loops:p,groups:n}};f();var Q={AGGREGATION:0,EXTENSION:1,COMPOSITION:2,DEPENDENCY:3,LOLLIPOP:4},St={LINE:0,DOTTED_LINE:1},zt=t=>{let e;switch(t){case St.LINE:e="solid";break;case St.DOTTED_LINE:e="dotted";break;default:e="solid"}return e},At=t=>{let e;switch(t){case Q.AGGREGATION:e="diamond_outline";break;case Q.COMPOSITION:e="diamond";break;case Q.EXTENSION:e="triangle_outline";break;case"none":e=null;break;case Q.DEPENDENCY:default:e="arrow";break}return e},Tt=(t,e)=>{let r=[],o=[],n=[];return Object.values(t).forEach(a=>{let{domId:s,id:i}=a,c=I(),l=e.querySelector(`[id*=classId-${i}]`);if(!l)throw Error(`DOM Node with id ${s} not found`);let{transformX:d,transformY:u}=Y(l),h=O(l.firstChild,"rectangle",{id:i,groupId:c});h.x+=d,h.y+=u,h.metadata={classId:i},r.push(h),Array.from(l.querySelectorAll(".divider")).forEach(g=>{let y=Number(g.getAttribute("x1")),A=Number(g.getAttribute("y1")),x=Number(g.getAttribute("x2")),b=Number(g.getAttribute("y2")),E=q(g,y,A,x,b,{groupId:c,id:I()});E.startX+=d,E.startY+=u,E.endX+=d,E.endY+=u,E.metadata={classId:i},o.push(E)});let w=l.querySelector(".label")?.children;if(!w)throw"label nodes not found";Array.from(w).forEach(g=>{let y=g.textContent;if(!y)return;let A=I(),{transformX:x,transformY:b}=Y(g),E=g.getBBox(),m=10,D=Z(d+x,u+b+m,y,{width:E.width,height:E.height,id:A,groupId:c,metadata:{classId:A}});n.push(D)})}),{nodes:r,lines:o,text:n}},Wt=(t,e,r,o)=>{let n=r.querySelector(".edgePaths")?.children;if(!n)throw new Error("No Edges found!");let a=[],s=[];return t.forEach((i,c)=>{let{id1:l,id2:d,relation:u}=i,h=e.find(M=>M.id===l),p=e.find(M=>M.id===d),w=zt(u.lineType),g=At(u.type1),y=At(u.type2),A=K(n[c]),{startX:x,startY:b,endX:E,endY:m}=A,D=rt(x,b,E,m,{strokeStyle:w,startArrowhead:g,endArrowhead:y,label:i.title?{text:i.title}:void 0,start:{type:"rectangle",id:h.id},end:{type:"rectangle",id:p.id}});a.push(D);let{relationTitle1:j,relationTitle2:J}=i,C=20,N=15,R=15,T,k;if(j&&j!=="none"){switch(o){case"TB":T=x-C,E<x&&(T-=R),k=b+N;break;case"BT":T=x+C,E>x&&(T+=R),k=b-N;break;case"LR":T=x+C,k=b+N,m>b&&(k+=R);break;case"RL":T=x-C,k=b-N,b>m&&(k-=R);break;default:T=x-C,k=b+N}let M=Z(T,k,j,{fontSize:16});s.push(M)}if(J&&J!=="none"){switch(o){case"TB":T=E+C,E<x&&(T+=R),k=m-N;break;case"BT":T=E-C,E>x&&(T-=R),k=m+N;break;case"LR":T=E-C,k=m-N,m>b&&(k-=R);break;case"RL":T=E+C,k=m+N,b>m&&(k+=R);break;default:T=E+C,k=m-N}let M=Z(T,k,J,{fontSize:16});s.push(M)}}),{arrows:a,text:s}},Ht=(t,e,r)=>{let o=[],n=[];return t.forEach(a=>{let{id:s,text:i,class:c}=a,l=e.querySelector(`#${s}`);if(!l)throw new Error(`Node with id ${s} not found!`);let{transformX:d,transformY:u}=Y(l),h=l.firstChild,p=O(h,"rectangle",{id:s,subtype:"note",label:{text:i}});if(Object.assign(p,{x:p.x+d,y:p.y+u}),o.push(p),c){let w=r.find(E=>E.id===c);if(!w)throw new Error(`class node with id ${c} not found!`);let g=p.x+(p.width||0)/2,y=p.y+(p.height||0),A=g,x=w.y,b=rt(g,y,A,x,{strokeStyle:"dotted",startArrowhead:null,endArrowhead:null,start:{id:p.id,type:"rectangle"},end:{id:w.id,type:"rectangle"}});n.push(b)}}),{notes:o,connectors:n}},kt=(t,e)=>{t.parse();let r=t.parser.yy,o=r.getDirection(),n=[],a=[],s=[],i=[],c=r.getNamespaces();Object.keys(c).length&&Object.values(c).forEach(g=>{let y=Tt(g.classes,e);n.push(y.nodes),a.push(...y.lines),s.push(...y.text),i.push(...y.nodes)});let l=r.getClasses();if(Object.keys(l).length){let g=Tt(l,e);n.push(g.nodes),a.push(...g.lines),s.push(...g.text),i.push(...g.nodes)}let d=r.getRelations(),{arrows:u,text:h}=Wt(d,i,e,o),{notes:p,connectors:w}=Ht(r.getNotes(),e,i);return n.push(p),u.push(...w),s.push(...h),{type:"class",nodes:n,lines:a,arrows:u,text:s,namespaces:c}};var Kt=t=>{let e=t.querySelector("svg");if(!e)throw new Error("SVG element not found");let r=e.getBoundingClientRect(),o=r.width,n=r.height;e.setAttribute("width",`${o}`),e.setAttribute("height",`${n}`);let a="image/svg+xml",s=unescape(encodeURIComponent(e.outerHTML)),c=`data:image/svg+xml;base64,${btoa(s)}`;return{type:"graphImage",mimeType:a,dataURL:c,width:o,height:n}},It=async t=>{B.initialize(nt);let e=await B.mermaidAPI.getDiagramFromText(gt(t)),{svg:r}=await B.render("mermaid-to-excalidraw",t),o=document.createElement("div");o.setAttribute("style","opacity: 0; position: relative; z-index: -1;"),o.innerHTML=r,o.id="mermaid-diagram",document.body.appendChild(o);let n;switch(e.type){case"flowchart-v2":{n=bt(e,o);break}case"sequence":{n=wt(e,o);break}case"classDiagram":{n=kt(e,o);break}default:n=Kt(o)}return o.remove(),n};var wr=async(t,e={})=>{let r=await It(t);return ft(r,e)};export{wr as parseMermaidToExcalidraw};
